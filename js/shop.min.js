document.addEventListener("DOMContentLoaded",(()=>{initButtons();updateValues();fetchEstablishments("./json/data.json")}));async function fetchEstablishments(path){try{const response=await fetch(path);const jsonData=await response.json();data=jsonData.items;data.forEach((item=>{const cityFilter=localStorage.getItem("cityFilter");if(cityFilter===item.location.city||cityFilter===""){createCard(item,document.getElementById("shopDisplay"))}}))}catch(error){console.error(`Error fetching establishments: ${error.message}`)}}async function createCard(item,element){const card=document.createElement("div");card.setAttribute("class","card col-md-3 px-0");card.setAttribute("style","width: 19rem");const cardBody=document.createElement("div");cardBody.setAttribute("class","card-body");const banner=document.createElement("img");banner.setAttribute("src",`${item.banner}`);banner.setAttribute("alt",`${item.establishmentName}-illustration photo`);banner.setAttribute("class","card-img-top");const cardHeading=document.createElement("h5");cardHeading.setAttribute("class","card-title");cardHeading.textContent=`${item.establishmentName}`;const cardOpeningHours=document.createElement("p");cardOpeningHours.setAttribute("class","fw-light");cardOpeningHours.textContent=`Delivery Hours: ${item.deliveryHours}`;const cardText=document.createElement("p");cardText.setAttribute("class","card-text");cardText.textContent=`${item.description.substring(0,50)}...`;const cardButton=document.createElement("a");cardButton.setAttribute("type","button");cardButton.setAttribute("href","./establishment.html");cardButton.setAttribute("class","btn btn-secondary");cardButton.addEventListener("click",(()=>{const current=localStorage.getItem("selectedEstablishment");if(current!==item.establishmentName&&current!==""){localStorage.setItem("cart",JSON.stringify([]));localStorage.setItem("selectedEstablishment",JSON.stringify(item))}else{localStorage.setItem("selectedEstablishment",JSON.stringify(item))}}));cardButton.textContent="View Menu";card.appendChild(banner);card.appendChild(cardBody);cardBody.appendChild(cardHeading);cardBody.appendChild(cardOpeningHours);cardBody.appendChild(cardText);cardBody.appendChild(cardButton);element.appendChild(card)}function showAlert(state){const alert=document.getElementById("filterAlert");if(state){alert.innerHTML="Could not find any establishments!";alert.removeAttribute("hidden")}}function initButtons(){const clearFilterButton=document.getElementById("clearFilterButton");const searchBarField=document.getElementById("searchBarField");const alert=document.getElementById("filterAlert");searchBarField.addEventListener("click",(()=>{document.getElementById("filterAlert").setAttribute("hidden",true);localStorage.setItem("cityFilter","")}));clearFilterButton.addEventListener("click",(()=>{clearFilterButton.setAttribute("hidden",true);alert.setAttribute("hidden",true);localStorage.setItem("cityFilter","");document.getElementById("shopDisplay").innerHTML="";fetchEstablishments("./json/data.json");updateValues()}))}function updateValues(){const getCart=localStorage.getItem("cart");const getCityFilter=localStorage.getItem("cityFilter");const currentUserIcon=document.getElementById("currentUser");const cartCount=document.getElementById("cartCount");const searchBarField=document.getElementById("searchBarField");const clearFilterButton=document.getElementById("clearFilterButton");if(getCityFilter!==""){clearFilterButton.removeAttribute("hidden")}if(getCityFilter==="-1"){showAlert(true)}var tempTotal=0;var tempCount=0;if(getCart!=="[]"){const getCart=JSON.parse(localStorage.getItem("cart"));getCart.forEach((item=>{const itemCount=document.getElementById(`${item.Type}-count`);if(itemCount!==null){itemCount.textContent=`${item.count}`}tempTotal+=item.count*item.Price;tempCount+=item.count}))}else{tempTotal=0;tempCount=0}cartCount.innerHTML=tempCount;searchBarField.value=localStorage.getItem("cityFilter")==="-1"?"":localStorage.getItem("cityFilter");displayUser(currentUserIcon)}function displayUser(element){if(localStorage.getItem("currentUser")!==""){const currentUser=JSON.parse(localStorage.getItem("currentUser"));element.setAttribute("class","bg-light rounded-3 p-1 ms-1 small");element.textContent=`${currentUser.uName}`}}